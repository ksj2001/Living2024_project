package control;

import java.io.IOException;
import java.util.ArrayList;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import model.DelivDTO;
import model.LivingDAO;
import model.OrdersDTO;
import model.ProductDTO;

@WebServlet("/CartOrderDone.do")
public class CartOrderDone extends HttpServlet {
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		reqPro(request, response);
	}

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		reqPro(request, response);
	}

	protected void reqPro(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		request.setCharacterEncoding("UTF-8");
		
		LivingDAO ldao = new LivingDAO();
		OrdersDTO odto = new OrdersDTO();
		DelivDTO ddto = new DelivDTO();
		ProductDTO pdto = new ProductDTO();
		ArrayList<ProductDTO> arr = new ArrayList<>();
		
		String[] codearr = request.getParameterValues("code");
		String[] imgarr = request.getParameterValues("img");
		String[] namearr = request.getParameterValues("name");
		String[] cntarr = request.getParameterValues("cnt");
		String[] pricearr = request.getParameterValues("price");
		String[] delivfeearr = request.getParameterValues("delivfee");
		String id = request.getParameter("id");
		
		int orderCode = ldao.codeaddSelect();
		
		for(int i=0;i<codearr.length;i++) {
			odto.setO_date(odto.getO_date());
			odto.setO_code(orderCode);
			odto.setP_code(Integer.parseInt(codearr[i]));
			odto.setO_qty(Integer.parseInt(cntarr[i]));
			odto.setO_total(Integer.parseInt(pricearr[i])*Integer.parseInt(cntarr[i]));
			odto.setM_id(id);
		}
	}
}
